<?xml version="1.0" encoding="US-ASCII"?>

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [

<!ENTITY RFC4271 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4271.xml">
<!ENTITY RFC6811 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6811.xml">
<!ENTITY RFC7454 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.7454.xml">
<!ENTITY RFC7908 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.7908.xml">
<!ENTITY RFC8092 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8092.xml">
<!ENTITY RFC8205 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8205.xml">
<!ENTITY I-D.ietf-idr-bgp-open-policy SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-idr-bgp-open-policy.xml">
<!--
<!ENTITY I-D.ietf-idr-aspath-orf SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-idr-aspath-orf.xml">

<!ENTITY I-D.ietf-idr-route-leak-detection-mitigation SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-idr-route-leak-detection-mitigation.xml">

<!ENTITY I-D.draft-sriram-idr-route-leak-solution-discussion SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-sriram-idr-route-leak-solution-discussion.xml">
-->
]>


<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<?rfc strict="yes" ?>
<?rfc toc="yes"?>
<?rfc tocdepth="4"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes" ?>
<?rfc compact="yes" ?>
<?rfc subcompact="no" ?>

<rfc category="std" docName="draft-ietf-idr-route-leak-detection-mitigation-11" ipr="trust200902">
  <front>
    <title abbrev="Route Leak Detection and Mitigation"> Methods for Detection and Mitigation of BGP Route Leaks </title>

    <author fullname="Kotikalapudi Sriram" initials="K." role="editor" surname="Sriram">
      <organization abbrev="USA NIST">USA National Institute of Standards and Technology</organization>
      <address>
         <postal>
          <street>100 Bureau Drive</street>
          <city>Gaithersburg</city>
          <region>MD</region>
          <code>20899</code>
          <country>United States of America</country>
        </postal>
        <email>ksriram@nist.gov</email>
      </address>
    </author>

    <author fullname="Alexander Azimov" initials="A." role="editor" surname="Azimov">
      <organization abbrev="Yandex">Yandex</organization>
      <address>
         <postal>
          <street></street>
          <city>Moscow</city>
          <region></region>
          <code></code>
          <country>Russia</country>
        </postal>
        <email>a.e.azimov@gmail.com</email>
      </address>
    </author>

    <date year="2019" />

    <area>Routing</area>

    <workgroup>IDR and SIDR</workgroup>

    <keyword>BGP, Route Leak Detection, Route-Leak Mitigation, BGP Security</keyword>

    <abstract>
      <t>
        Problem definition for route leaks and enumeration of types of route leaks are provided in RFC 7908.
        This document describes a inter-AS (multi-hop) solution for detection and mitigation route leaks which is based on conveying route-leak detection information in two new well-known BGP communities: route leak detection community (RLD) and route leak notification community (RLN).
        These communities gives ISPs an easy way to detect route leaks, and, if needed, propagate information about such incidents.
        This solution complements the intra-AS (local AS) route-leak avoidance solution that is described in ietf-idr-bgp-open-policy draft.
      </t>
    </abstract>

  </front>

  <middle>
    <section title="Introduction">
      <t>
        RFC 7908 <xref target="RFC7908"></xref> provides a definition of the route leak problem, and enumerates several types of route leaks.
        For this document, the definition that is applied is that a route leak occurs when a route received from a transit provider or a lateral peer is forwarded (against commonly used policy) to another transit provider or a lateral peer.
        The commonly used policy is that a route received from a transit provider or a lateral peer may be forwarded only to customers.
      </t>
      <t>
        This document describes a solution for detection and mitigation route leaks which is based on conveying route-leak information in a Border Gateway Protocol (BGP) community.
        These document specified two well-known communities for these purpose - route leak detection (RLP) and route leak notification (RLN) community.
        Its configuration policies MUST be defined according to peering relations between ISPs.
        If BGP Roles described in <xref target="I-D.ietf-idr-bgp-open-policy"></xref> are configured community configuration should implemented in code of routing software.
      </t>
      <t>
        Described technique can be incrementally deployed.
        If a group of big ISPs or/and IXes deploy proposed route marking, then they would be helping each other by blocking route leaks that can happen between them.
      </t>
    </section>

    <section anchor="relations" title="Peering Relationships">
      <t>
        As described in <xref target="I-D.ietf-idr-bgp-open-policy"></xref> there are several common peering relations foe eBGP sessions:
        <list style="symbols">
          <t>Provider - sender is a transit provider to neighbor;</t>
          <t>Customer - sender is customer of neighbor;</t>
          <t>RS - sender is route server at internet exchange point (IX)</t>
          <t>RS-client - sender is client of RS at internet exchange point (IX)</t>
          <t>Peer - sender and neighbor are peers;</t>
        </list>
      </t>
      <t>
        If the route is announced to a customer or RS-client it MUST go 'only down' and should not be received by other ISPs from links with customers, peers or at IX route servers from RS-clients.
        The described below community provide an easy way to maintain this rule.
      </t>
    </section>

    <section anchor="detection" title="Route-Leak Detection">
      <t>
        The RLD community MUST follow next semantics:
        <list style="numbers">
          <t>4200000000 - suggested class for well-known large communities;</t>
          <t>1 - RLD subclass;</t>
          <t>value - ASN who set the community</t>
        </list>
        This community MUST be set if route is announced to Customer, RS-client or Peer with a proper ASN.
      </t>
      <t>
        The are two rules that enables detection route leaks:
        <list style="symbols">
          <t>If route with RLD set received from Customer or RS-client - it's a route leak</t>
          <t>If route with RLD set received from Peer and RLD Values isn't equal to neighbor ASN - it's route leak</t>
        </list>
        This two rules provide an easy way to detect policy violation at the per-prefix granularity.
      </t>

    <section anchor="mitigation" title="Route-Leak Mitigation">
      <t>

      </t>

<section anchor="format" title="Format of the RLP Community">

<t>
The format of the RLP community using a single Large Community is shown in <xref target="fig2"></xref>.
</t>
<figure align="center" anchor="fig2" title="Format of the RLP Community using a Large Community [RFC8092].">
  <artwork align="left"><![CDATA[

 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Global Administrator  (IANA assigned for RLP)           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|            Local Data Part 1 = DO (ASN value)                 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|            Local Data Part 2 = L (ASN value)                  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

]]></artwork>
 </figure>



</section>
</section>
<section anchor="receiver" title="Route Leak Detection Rules and the Ingress Router (Receiver) Actions">

<t>
A received BGP update is determined to be a route leak if:
</t>
<t>
<list style="numbers">
<t>
if L is present in the update;
</t>
<t>
else (L is absent), the update is received from a customer and DO is present;
</t>
<t>
else (L is absent), the update is received from a lateral peer and DO is present that is not the lateral peer's ASN.
</t>
</list>
</t>
<t>
Note: Here by "L is present" we mean that its value is not the default value (all zeros) but is a proper ASN. Effectively "L is absent" if its value is the default value.
</t>
<t>
In steps 2 and 3 above, the ingress router (receiver) MUST add L = local ANS. Doing this prior to the best path selection process is necessary. Also, if the route is selected as best path, then L is already set correctly before the egress router (sender) acts on it.
</t>

</section>
<section anchor="decision" title="Route Selection Policy">
<t>
Minimum Default Policy: Whenever there is a choice between a customer route and a provider route that are both detected to be leaks (L is present), then lower the LocalPref to X (TBD by operator) for each of them. Then shortest path criterion would typically make the customer route preferred. (Note: This would help mitigate any possibility of persistent oscillation; see slide #7 in <xref target="sriram1"></xref>.)
</t>
<t>
Generalized Minimum Default Policy: Whenever there is a choice between multiple routes (customer/peer/provider) and each is detected to be a leak (L is present), then lower the LocalPref to X TBD by operator) for each of them. Then apply shortest path criterion. (Note: Some network operators may find this inadequate; see scenarios #3 and #6 in slides #14 and #16, respectively, in <xref target="sriram2"></xref>. But they may locally modify their policy while respecting the basic principle.)
</t>
</section>

<section anchor="sender" title="Egress Router (Sender) Actions">
<t>
After best path selection has been performed, a sender MUST perform the following RLP-related actions on the update to be propagated:
</t>
<t>
<list style="numbers">
<t>
When propagating a route originated by the local AS to a customer or lateral peer, add DO = local ASN;
</t>
<t>
Else, when propagating a route that already includes a DO (i.e., was received with a DO) to a customer or lateral peer, replace the DO value with the local ASN.
</t>
</list>
</t>
</section>
</section>

<section anchor="pseudo" title="Pseudo Code">

<t>
[Begin: receiver action for route leak detection]
</t>
<t>
{Comment: This precedes route selection policy.}
</t>
<t>
<list style="">
<t>
if received route includes L, then save the route in RIB-in as is;
</t>
<t>
else (L is absent), if route is received from a customer and DO is preset, then add L = local ASN;
</t>
<t>
else (L is absent), if route is received from a lateral peer and DO is present that is not the lateral peer's ASN, then add L = local ASN
</t>
</list>
</t>
<t>
{Comment: "Route does not include L" or "L is absent" only if L is either literally absent or has the default (all zeros) value.}
</t>
<t>
[End: receiver action for route leak detection]
</t>
<t>
----------------------------------------------------------
</t>
<t>
[Begin: route selection policy]
</t>
<t>
<list style="">
<t>
for each route that includes L, lower the LocalPref to X (TBD);
apply best path selection policy*
</t>
</list>
</t>
<t>
{*Comment: E.g., best path selection based on LocalPref first and then shortest path.}
</t>
<t>
[End: route selection policy]
</t>
<t>
----------------------------------------------------------
</t>
<t>
[Begin: sender action]
</t>
<t>
{Comment: RLP (includes DO and L or just DO) is a *transitive* BGP community and should propagate globally.}
</t>
<t>
<list style="">
<t>
when propagating a route originated by local AS to a customer or lateral peer, add DO = local ASN;
</t>
<t>
when propagating a route that includes a DO (i.e., was received with a DO) to a customer or lateral peer, replace the DO value with the local ASN;
</t>
</list>
</t>
<t>
[End: sender action]
</t>
</section>

   <section anchor="Security" title="Security Considerations">
<t>
With the use of BGP community, there is often a concern that the community propagates beyond its intended perimeter and causes harm <xref target="streibelt"></xref>. However, that concern does not apply to the RLP community because it is a transitive community that must propagate as far as the update goes.
</t>
<t>
The proposed Route-Leak Protection (RLP) information carried in the RLP community can benefit from cryptographic protection to prevent abuse by malicious actors in the AS path. In the future, if there is BGPsec deployment, the RLP information can be encoded in the Flags field in the Secure_Path Segment in BGPsec updates <xref target="RFC8205"></xref>. So, the cryptographic security mechanisms in BGPsec can also secure the RLP information. The reader is directed to the security considerations provided in <xref target="RFC8205"></xref>.
    </t>

    </section>


    <section anchor="IANA" title="IANA Considerations">
<t>
IANA is requested to register RLP in the well-known Large Community <xref target="RFC8092"></xref> registry (need help to clarify this). IANA is requested to allocate a new Global Administrator ID for the RLP community (Large Community) (see <xref target="fig2"></xref> in this document). Note that BGP Path Attribute value for Large Community is 32 (IANA allocated) <xref target="RFC8092"></xref>.
</t>

    </section>



    </middle>

  <!--  *****BACK MATTER ***** -->

  <back>

 <references title="Normative References">
&RFC4271;
 </references>

    <references title="Informative References">
&RFC6811;
&RFC7454;
&RFC7908;
&RFC8092;
&RFC8205;


&I-D.ietf-idr-bgp-open-policy;
      <reference anchor="Luckie" target="http://www.caida.org/~amogh/papers/asrank-IMC13.pdf">
        <front>
          <title>AS Relationships, Customer Cones, and Validation</title>

<author initials="M." surname="Luckie">
          <organization></organization>
          </author>
<author initials="B." surname="Huffaker">
          <organization></organization>
          </author>
<author initials="A." surname="Dhamdhere">
          <organization></organization>
          </author>
<author initials="V." surname="Giotsas">
          <organization></organization>
          </author>
<author initials="kc" surname="claffy">
          <organization></organization>
          </author>

          <date month='October' year='2013' />
        </front>
        <seriesInfo name='' value='IMC 2013' />
      </reference>

<reference anchor="draft-dickson-sidr-route-leak-solns" target="https://tools.ietf.org/html/draft-dickson-sidr-route-leak-solns-01">
        <front>
          <title>Route Leaks -- Proposed Solutions</title>

<author initials="B." surname="Dickson">
          <organization></organization>
          </author>

          <date month='March' year='2012' />
        </front>
<seriesInfo name='' value='IETF Internet Draft (expired)' />
      </reference>
    </references>
  </back>
</rfc>